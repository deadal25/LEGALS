<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>Tables</title>

    <!-- Fontfaces CSS-->
    <link href="css/font-face.css" rel="stylesheet" media="all">

    <link href="vendor/fontawesome-7.0.1/css/all.min.css" rel="stylesheet" media="all">
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="vendor/bootstrap-5.3.8.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="css/aos.css" rel="stylesheet" media="all">
    <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="css/swiper-bundle-11.2.10.min.css" rel="stylesheet" media="all">
    <link href="vendor/perfect-scrollbar/perfect-scrollbar-1.5.6.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">

    <style>
        /* =============================
   STATUS TANDA TANGAN STYLE
   ============================= */

        #lastUpdate {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 15px;
            text-align: right;
            font-style: italic;
            letter-spacing: 0.3px;
        }

        /* ======= TABLE ======= */
        #statusTable {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        #statusTable th {
            background: linear-gradient(90deg, #191c1f, #696d71);
            color: #fff;
            font-weight: 600;
            text-align: center;
            padding: 12px 10px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            border: none;
        }

        #statusTable td {
            text-align: center;
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 18px;
            color: #333;
            vertical-align: middle;
        }

        #statusTable tr:last-child td {
            border-bottom: none;
        }

        #statusTable tr:hover {
            background-color: #f8fbff;
            transition: background 0.2s ease;
        }

        /* ======= STATUS COLORS ======= */
        .done {
            color: #28a745;
            font-weight: 600;
        }

        .pending {
            color: #f39c12;
            font-weight: 600;
        }

        /* ======= BUTTONS ======= */
        .aksi-cell {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            justify-content: center;
        }

        .btn {
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            padding: 7px 14px;
            color: #fff;
            font-weight: 500;
            min-width: 110px;
            transition: all 0.25s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-email {
            background-color: #1a73e8;
        }

        .btn-wa {
            background-color: #25D366;
        }

        .btn-disabled {
            background-color: #ccc !important;
            cursor: not-allowed;
            color: #666 !important;
            opacity: 0.8;
            box-shadow: none;
        }

        /* ======= RESPONSIVE ======= */
        @media (max-width: 992px) {

            #statusTable th,
            #statusTable td {
                font-size: 12px;
                padding: 8px;
            }

            .btn {
                min-width: 90px;
                padding: 6px 10px;
            }
        }

        @media (max-width: 576px) {
            #lastUpdate {
                text-align: center;
                font-size: 12px;
            }

            .aksi-cell {
                gap: 4px;
            }
        }

        body.dark-mode {
            background-color: #ffffff !important;
            color: #fffefe !important;
        }

        body.dark-mode .card,
        body.dark-mode .header-desktop {
            background-color: #6d6a6a !important;
            color: #ffffff !important;
        }

        body.dark-mode .main-content {
            background-color: #8f8989 !important;
            color: #ffffff !important;
        }

        body.dark-mode a {
            color: #000000 !important;
        }

        body.dark-mode .account-dropdown {
            background-color: #6d6a6a !important;
        }

        body.dark-mode .account-dropdown__item a {
            color: #ffffff !important;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 90px;
            height: 32px;
        }

        .switch-input {
            display: none;
        }

        .switch-label {
            display: block;
            cursor: pointer;
            border: 2px solid #ccc;
            border-radius: 50px;
            background-color: #f5f5f5;
            text-align: center;
            font-size: 14px;
            line-height: 28px;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
            box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.1);
        }

        .navbar__list li a.active {
  background-color: #e8f0fe; /* warna terang seperti highlight */
  color: #1a73e8 !important; /* biru agar selaras */
  border-radius: 8px;
  font-weight: 600;
}

/* Mode gelap */
body.dark-mode .navbar__list li a.active{
  background-color: #6d6a6a;
  color: #0a0a0a !important;
  border-radius: 8px;
}
/* Perbaiki agar active juga muncul di menu mobile */
.navbar-mobile__list li a.active {
  background-color: #e8f0fe !important;
  color: #1a73e8 !important;
  border-radius: 8px !important;
  font-weight: 600;
}

/* Versi dark mode */
body.dark-mode .navbar-mobile__list li a.active {
  background-color: #6d6a6a !important;
  color: #0a0a0a !important;
}

    </style>



</head>

<body>
    <div class="page-wrapper">
        <!-- HEADER MOBILE-->
        <header class="header-mobile d-block d-lg-none">
            <div class="header-mobile__bar">
                <div class="container-fluid">
                    <div class="header-mobile-inner">
                        <a class="logo" href="index.html">
                            <img src="images/icon/logo.png" alt="CoolAdmin" />
                        </a>
                        <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <nav class="navbar-mobile">
                <div class="container-fluid">
                    <ul class="navbar-mobile__list list-unstyled">
                        <!-- <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-tachometer-alt"></i>Dashboard</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="index.html">Dashboard 1</a>
                                </li>
                                <li>
                                    <a href="index2.html">Dashboard 2</a>
                                </li>
                                <li>
                                    <a href="index3.html">Dashboard 3</a>
                                </li>
                                <li>
                                    <a href="index4.html">Dashboard 4</a>
                                </li>
                            </ul>
                        </li> -->
                        <li>
                            <a href="index.html">
                                <i class="fas fa-tachometer-alt "></i>Dashboard</a>
                        </li>
                        <!-- <li>
                            <a href="chart.html">
                                <i class="fas fa-chart-bar"></i>Charts</a>
                        </li> -->
                        <li>
                            <a class="active"  href="progresttd.html">
                                <i class="fas fa-tasks"></i>Progres TTD</a>
                        </li>
                        
                        <li>
                            <a href="form.html">
                                <i class="far fa-check-square"></i>Forms</a>
                        </li>

                        <li>
                            <a href="statusdokumen.html">
                                <i class="fas fa-file-alt"></i>Status Dokumen</a>
                        </li>
                        <li>
                            <a href="calendar.html">
                                <i class="fas fa-calendar-alt"></i>Calendar</a>
                        </li>
                        <li>
                            <a href="map.html">
                                <i class="fas fa-map-marker-alt"></i>Maps</a>
                        </li>
                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-desktop"></i>Account</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                
                                <li id="menuAccountMobile">
                                    <a href="register.html">
                                        <i class="fas fa-user"></i> Register
                                    </a>
                                </li>
                                <!-- <li id="menuAccountMobile1">
                                    <a href="forget-pass.html">
                                        <i class="fas fa-unlock-alt"></i> Forget Password
                                    </a>
                                </li> -->
                                <li id="menuAccountMobile1">
                                    <a href="users.html">
                                        <i class="fas fa-user-edit"></i> Users
                                    </a>
                                </li>
                                <li id="menuAccountMobile2">
                                    <a href="approval.html" >
                                        <i class="fas fa-tasks"></i> Approval
                                    </a>
                                </li>
                                <li>
                                    <a href="profile.html">
                                        <i class="far fa-id-card"></i> Profil Akun
                                    </a>
                                </li>
                                <li>
                                    <a href="login.html">
                                        <i class="fas fa-sign-in-alt"></i> Logout
                                    </a>
                                </li>
                            </ul>

                        </li>
                        <!-- <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-desktop"></i>UI Elements</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="button.html">Button</a>
                                </li>
                                <li>
                                    <a href="badge.html">Badges</a>
                                </li>
                                <li>
                                    <a href="tab.html">Tabs</a>
                                </li>
                                <li>
                                    <a href="card.html">Cards</a>
                                </li>
                                <li>
                                    <a href="alert.html">Alerts</a>
                                </li>
                                <li>
                                    <a href="progress-bar.html">Progress Bars</a>
                                </li>
                                <li>
                                    <a href="modal.html">Modals</a>
                                </li>
                                <li>
                                    <a href="switch.html">Switchs</a>
                                </li>
                                <li>
                                    <a href="grid.html">Grids</a>
                                </li>
                                <li>
                                    <a href="fontawesome.html">Fontawesome Icon</a>
                                </li>
                                <li>
                                    <a href="typo.html">Typography</a>
                                </li>
                            </ul>
                        </li> -->
                    </ul>
                </div>
            </nav>
        </header>
        <!-- END HEADER MOBILE-->

        <!-- MENU SIDEBAR-->
        <aside class="menu-sidebar d-none d-lg-block">
            <div class="logo">
                <a href="#">
                    <img src="images/icon/logo.png" alt="Cool Admin" />
                </a>
            </div>
            <div class="menu-sidebar__content js-scrollbar1">
                <nav class="navbar-sidebar">
                    <ul class="list-unstyled navbar__list">
                        <!-- <li class="active has-sub">
                            <a class="js-arrow" href="#">
                                <i href="index.html" class="fas fa-tachometer-alt"></i>Dashboard</a>
                            <ul class="list-unstyled navbar__sub-list js-sub-list">
                                <li>
                                    <a href="index.html">Dashboard 1</a>
                                </li>
                                <li>
                                    <a href="index2.html">Dashboard 2</a>
                                </li>
                                <li>
                                    <a href="index3.html">Dashboard 3</a>
                                </li>
                                <li>
                                    <a href="index4.html">Dashboard 4</a>
                                </li>
                            </ul>
                        </li> -->
                        <li>
                            <a href="index.html">
                                <i class="fas fa-tachometer-alt"></i>Dashboard</a>
                        </li>
                        <!-- <li>
                            <a href="chart.html">
                                <i class="fas fa-chart-bar"></i>Charts</a>
                        </li> -->
                        <li>
                            <a class="active"  href="progresttd.html">
                                <i class="fas fa-tasks"></i>Progres TTD</a>
                        </li>
                        
                        <li>
                            <a href="form.html">
                                <i class="far fa-check-square"></i>Forms</a>
                        </li>

                        <li>
                            <a href="statusdokumen.html">
                                <i class="fas fa-file-alt"></i>Status Dokumen</a>
                        </li>
                        <li>
                            <a href="calendar.html">
                                <i class="fas fa-calendar-alt"></i>Calendar</a>
                        </li>
                        <li>
                            <a href="map.html">
                                <i class="fas fa-map-marker-alt"></i>Maps</a>
                        </li>
                        <li class="has-sub" >
                            <a class="js-arrow" href="#">
                                <i class="fas fa-desktop"></i>Account</a>
                            <ul class="list-unstyled navbar__sub-list js-sub-list">
                                
                                <li id="menuAccountDesktop">
                                    <a href="register.html">
                                        <i class="fas fa-user"></i> Register
                                    </a>
                                </li>
                                <!-- <li id="menuAccountDesktop1">
                                    <a href="forget-pass.html">
                                        <i class="fas fa-unlock-alt"></i> Forget Password
                                    </a>
                                </li> -->
                                <li id="menuAccountDesktop1">
                                    <a href="users.html">
                                        <i class="fas fa-user-edit"></i> Users
                                    </a>
                                </li>
                                <li id="menuAccountDesktop2">
                                    <a href="approval.html" >
                                        <i class="fas fa-tasks"></i> Approval
                                    </a>
                                </li>
                                <li>
                                    <a href="profile.html">
                                        <i class="far fa-id-card"></i> Profil Akun
                                    </a>
                                </li>
                                 <li>
                                    <a href="login.html">
                                        <i class="fas fa-sign-in-alt"></i> Logout
                                    </a>
                                </li>
                            </ul>

                        </li>
                        <!-- <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-desktop"></i>UI Elements</a>
                            <ul class="list-unstyled navbar__sub-list js-sub-list">
                                <li>
                                    <a href="button.html">Button</a>
                                </li>
                                <li>
                                    <a href="badge.html">Badges</a>
                                </li>
                                <li>
                                    <a href="tab.html">Tabs</a>
                                </li>
                                <li>
                                    <a href="card.html">Cards</a>
                                </li>
                                <li>
                                    <a href="alert.html">Alerts</a>
                                </li>
                                <li>
                                    <a href="progress-bar.html">Progress Bars</a>
                                </li>
                                <li>
                                    <a href="modal.html">Modals</a>
                                </li>
                                <li>
                                    <a href="switch.html">Switchs</a>
                                </li>
                                <li>
                                    <a href="grid.html">Grids</a>
                                </li>
                                <li>
                                    <a href="fontawesome.html">Fontawesome Icon</a>
                                </li>
                                <li>
                                    <a href="typo.html">Typography</a>
                                </li>
                            </ul>
                        </li> -->
                    </ul>
                </nav>
            </div>
        </aside>
        <!-- END MENU SIDEBAR-->

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <header class="header-desktop">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="header-wrap">
                            <form class="form-header" onsubmit="handleSearch(event)">
                                <input id="searchInput" class="au-input au-input--xl" type="text" name="search"
                                    placeholder="Cari berdasarkan No. Perjanjian..." />
                                <button class="au-btn--submit" type="submit">
                                    <i class="zmdi zmdi-search"></i>
                                </button>
                            </form>

                            <div class="header-button">
                                <div class="noti-wrap">
                                    <div class="noti__item js-item-menu">
                                        <i class="zmdi zmdi-comment-more"></i>
                                        <span class="quantity">1</span>
                                        <div class="mess-dropdown js-dropdown">
                                            <div class="mess__title">
                                                <p>You have 2 news message</p>
                                            </div>
                                            <div class="mess__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-06.jpg" alt="Michelle Moreno" />
                                                </div>
                                                <div class="content">
                                                    <h6>Michelle Moreno</h6>
                                                    <p>Have sent a photo</p>
                                                    <span class="time">3 min ago</span>
                                                </div>
                                            </div>
                                            <div class="mess__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-04.jpg" alt="Diane Myers" />
                                                </div>
                                                <div class="content">
                                                    <h6>Diane Myers</h6>
                                                    <p>You are now connected on message</p>
                                                    <span class="time">Yesterday</span>
                                                </div>
                                            </div>
                                            <div class="mess__footer">
                                                <a href="#">View all messages</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="noti__item js-item-menu">
                                        <i class="zmdi zmdi-email"></i>
                                        <span class="quantity">1</span>
                                        <div class="email-dropdown js-dropdown">
                                            <div class="email__title">
                                                <p>You have 3 New Emails</p>
                                            </div>
                                            <div class="email__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-06.jpg" alt="Cynthia Harvey" />
                                                </div>
                                                <div class="content">
                                                    <p>Meeting about new dashboard...</p>
                                                    <span>Cynthia Harvey, 3 min ago</span>
                                                </div>
                                            </div>
                                            <div class="email__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-05.jpg" alt="Cynthia Harvey" />
                                                </div>
                                                <div class="content">
                                                    <p>Meeting about new dashboard...</p>
                                                    <span>Cynthia Harvey, Yesterday</span>
                                                </div>
                                            </div>
                                            <div class="email__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-04.jpg" alt="Cynthia Harvey" />
                                                </div>
                                                <div class="content">
                                                    <p>Meeting about new dashboard...</p>
                                                    <span>Cynthia Harvey, January 15, 2025</span>
                                                </div>
                                            </div>
                                            <div class="email__footer">
                                                <a href="#">See all emails</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="noti__item js-item-menu">
                                        <i class="zmdi zmdi-notifications"></i>
                                        <span class="quantity">3</span>
                                        <div class="notifi-dropdown js-dropdown">
                                            <div class="notifi__title">
                                                <p>You have 3 Notifications</p>
                                            </div>
                                            <div class="notifi__item">
                                                <div class="bg-c1 img-cir img-40">
                                                    <i class="zmdi zmdi-email-open"></i>
                                                </div>
                                                <div class="content">
                                                    <p>You got a email notification</p>
                                                    <span class="date">January 15, 2025 14:30</span>
                                                </div>
                                            </div>
                                            <div class="notifi__item">
                                                <div class="bg-c2 img-cir img-40">
                                                    <i class="zmdi zmdi-account-box"></i>
                                                </div>
                                                <div class="content">
                                                    <p>Your account has been blocked</p>
                                                    <span class="date">January 15, 2025 14:30</span>
                                                </div>
                                            </div>
                                            <div class="notifi__item">
                                                <div class="bg-c3 img-cir img-40">
                                                    <i class="zmdi zmdi-file-text"></i>
                                                </div>
                                                <div class="content">
                                                    <p>You got a new file</p>
                                                    <span class="date">January 15, 2025 14:30</span>
                                                </div>
                                            </div>
                                            <div class="notifi__footer">
                                                <a href="#">All notifications</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="account-wrap">
                                    <div class="account-item clearfix js-item-menu">
                                        <div class="image">
                                            <img id="userAvatar" src="images/icon/avatar-01.jpg" alt="User Avatar" />
                                        </div>
                                        <div class="content">
                                            <a class="js-acc-btn" id="userName" href="#">User</a>
                                        </div>
                                        <div class="account-dropdown js-dropdown">
                                            <div class="info clearfix">
                                                <div class="image">
                                                    <a href="#">
                                                        <img id="dropdownAvatar" src="images/icon/avatar-01.jpg"
                                                            alt="User Avatar" />
                                                    </a>
                                                </div>
                                                <div class="content" style="height: 5px; margin-top: -11px;">
                                                    <h5 class="name">
                                                        <a href="#" id="dropdownName">User</a>
                                                    </h5>
                                                    <span class="email" id="dropdownEmail">user@example.com</span><br>
                                                    <small id="dropdownCabang" style="color:#777;">Cabang: -</small>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__body">
                                                <div class="account-dropdown__item">
                                                    <a href="profile.html"><i class="zmdi zmdi-account"></i>Account</a>
                                                </div>
                                                <!-- <div class="account-dropdown__item">
                                                    <a href="#"><i class="zmdi zmdi-settings"></i>Setting</a>
                                                </div> -->
                                                <div class="account-dropdown__item">
                                                    <a href="#">
                                                        <i class="zmdi zmdi-settings"></i>Tema

                                                        <!-- <span id="themeLabel">Terang</span> -->
                                                        <label class="switch switch-text switch-secondary switch-pill"
                                                            style="margin-left: 5px; width: 100px;">
                                                            <input id="themeToggle" type="checkbox"
                                                                class="switch-input">
                                                            <span data-on="Gelap" data-off="Terang"
                                                                class="switch-label"></span>
                                                            <span class="switch-handle"></span>
                                                        </label>
                                                    </a>
                                                </div>



                                                <!-- <div class="account-dropdown__item">
                                                    <a href="#"><i class="zmdi zmdi-money-box"></i>Billing</a>
                                                </div> -->
                                            </div>
                                            <div class="account-dropdown__footer"
                                                style="background-color: #db3232; margin-top: -18px;">
                                                <a href="#" id="logoutBtn">
                                                    <i class="zmdi zmdi-power"></i>Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- END HEADER DESKTOP-->

            <!-- MAIN CONTENT-->
            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="table-responsive table--no-card m-b-30">

                                    <div id="lastUpdate">Terakhir diperbarui: -</div>

                                    <table class="table table-borderless table-striped table-earning" id="statusTable">
                                        <thead>
                                            <tr>
                                                <th rowspan="2">No. Perjanjian</th>
                                                <th rowspan="2">Nama Perusahaan</th>
                                                <th rowspan="2">Alamat Pembeli</th>
                                                <th rowspan="2">Email Pembeli</th>
                                                <th rowspan="2">No. HP Pembeli</th>
                                                <th rowspan="2">Status Approval</th>
                                                <th colspan="2">Sales</th>
                                                <th colspan="2">ADH</th>
                                                <th colspan="2">Penjual</th>
                                                <th colspan="2">Pembeli</th>
                                                <th rowspan="2">Aksi</th>
                                            </tr>
                                            <tr>
                                                <th>Waktu</th>
                                                <th>Status</th>
                                                <th>Waktu</th>
                                                <th>Status</th>
                                                <th>Waktu</th>
                                                <th>Status</th>
                                                <th>Waktu</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="14">Memuat data...</td>
                                            </tr>
                                        </tbody>
                                    </table>



                                </div>
                            </div>
                            <!-- <div class="row">
                                <div class="col-md-12">
                                    <div class="copyright">
                                        <p>Copyright ¬© 2025 Alqadri. All rights reserved. Template by <a
                                                href="https://alqadri.com" rel="nofollow" target="_blank">Colorlib</a>.
                                        </p>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Jquery JS-->
        <script src="js/vanilla-utils.js"></script>
        <!-- Bootstrap JS-->
        <script src="vendor/bootstrap-5.3.8.bundle.min.js"></script>
        <!-- Vendor JS       -->
        <script src="vendor/perfect-scrollbar/perfect-scrollbar-1.5.6.min.js"></script>
        <script src="vendor/chartjs/chart.umd.js-4.5.0.min.js"></script>

        
        <script>
document.addEventListener("DOMContentLoaded", function () {
  // =============================
  // 1Ô∏è‚É£ Ambil data user dari localStorage
  // =============================
  const user = JSON.parse(localStorage.getItem("user"));
  if (!user) {
    window.location.href = "login.html";
    return;
  }
  /* üîí SEMBUNYIKAN MENU ACCOUNT JIKA BUKAN ADMIN */
if ((user.role || "").toLowerCase() !== "admin") {
    const accMobile = document.getElementById("menuAccountMobile");
                    const accMobile1 = document.getElementById("menuAccountMobile1");
                    const accMobile2 = document.getElementById("menuAccountMobile2");
                    const accDesktop = document.getElementById("menuAccountDesktop");
                    const accDesktop1 = document.getElementById("menuAccountDesktop1");
                    const accDesktop2 = document.getElementById("menuAccountDesktop2");

                    if (accMobile) accMobile.style.display = "none";
                    if (accMobile1) accMobile1.style.display = "none";
                    if (accMobile2) accMobile2.style.display = "none";
                    if (accDesktop) accDesktop.style.display = "none";
                    if (accDesktop1) accDesktop1.style.display = "none";
                    if (accDesktop2) accDesktop2.style.display = "none";
}


  // =============================
  // 2Ô∏è‚É£ Tampilkan Profil Login
  // =============================
  document.getElementById("userName").textContent = user.namaLengkap || "User";
  document.getElementById("dropdownName").textContent = user.namaLengkap || "User";
  document.getElementById("dropdownEmail").textContent = user.email || "-";

  if (user.avatarUrl) {
    document.getElementById("userAvatar").src = user.avatarUrl;
    document.getElementById("dropdownAvatar").src = user.avatarUrl;
  }

  // Tombol logout
  document.getElementById("logoutBtn").addEventListener("click", function (e) {
    e.preventDefault();
    localStorage.removeItem("user");
    window.location.href = "login.html";
  });

  // =============================
  // 3Ô∏è‚É£ Mapping Cabang Ke Kode (Multi-Akses)
  // =============================

  const cabangUser = user.role ? user.role.trim().toUpperCase() : "ADMIN";

  const cabangMap = {
    "ADMIN": ["ADMIN"],
            "MAKASSAR": ["MKS", "PRE", "MMJ"],
            "PALU": ["PLU", "PGM"],
            "PAREPARE": ["PRE"],
            "MAMUJU": ["MMJ"],
             "BULUNGAN": ["BLG"],
             "KENDARI": ["KDR"],
             "SORONG": ["SOR"],
             "GORONTALO": ["GTL"],
             "CILEGON": ["CLG"],
             "JAYAPURA": ["JPR"],
             "SAMARINDA": ["SMD"],
              "PONTIANAK": ["PTK"],
            "BANJARMASIN": ["BJM"],
            "BALIKPAPAN": ["BPP"]
  };

  // Jika tidak ditemukan, fallback ke akses cabang sendiri
  window.kodeCabang = cabangMap[cabangUser] || [cabangUser];

  // =============================
  // 4Ô∏è‚É£ URL API
  // =============================
  const apiUrlBase = "https://script.google.com/macros/s/AKfycbwyutAXOuSEfy1yItsWsWNCPBzOqyI-lktXPUdizX3H05Bj-syHkbrUIIbWWPGvXDBI8Q/exec";
  window.apiUrl = `${apiUrlBase}?mode=status`;
  window.notifyUrl = `${apiUrlBase}?mode=notify`;

  // =============================
  // 5Ô∏è‚É£ Tampilkan label cabang di UI
  // =============================
  document.getElementById("dropdownCabang").textContent =
    cabangUser === "ADMIN"
      ? "Admin"
      : `${cabangUser}`;

  console.log("Cabang login:", cabangUser, "‚Üí Kode Akses:", window.kodeCabang);

  // =============================
  // 6Ô∏è‚É£ Load Data Awal + Auto Refresh
  // =============================
  loadStatusData();
  setInterval(loadStatusData, 5000);
});

// =============================
// 5Ô∏è‚É£ Fungsi Pendukung
// =============================
function formatWaktu(str) {
  if (!str || str === "-" || str === "undefined") return "-";
  const d = new Date(str);
  if (isNaN(d)) return str;
  return d.toLocaleDateString("id-ID") + " " + d.toLocaleTimeString("id-ID", { hour12: false });
}

// function normalizeApproval(statusApproval) {
//   const s = (statusApproval || "").toString().trim().toUpperCase();
//   return s === "DITERIMA" ? "DITERIMA" : "PENDING";
// }


function makeStatus(status) {
  if (!status || status === "-" || status === "undefined" ) return `<span class="pending">‚ùå Belum TTD</span>`;
  const cls = status.includes("‚úÖ") ? "done" : "pending";
  return `<span class="${cls}">${status}</span>`;
}

function disableReminderByApproval(statusApproval) {
    if (!statusApproval) return true;   // kalau kosong ‚Üí dianggap PENDING ‚Üí disable

    const s = statusApproval.toString().trim().toUpperCase();

    // Hanya DITERIMA yang boleh aktif ‚Üí selain itu di-disable
    return (s !== "DITERIMA");
}



function makeAksiButtons(row) {

  const approvalLocked = disableReminderByApproval(row.statusApproval);

  const noperjanjian = row.noperjanjian;
  const nohp = row.nohp_pembeli;
  const docId = row.docId || "";

  // Jika approval PENDING atau DITERIMA ‚Üí semua tombol disabled
  if (approvalLocked) {
    return `
      <div class="aksi-cell">
        <button class="btn btn-disabled" disabled>üìß Email Sales</button>
        <button class="btn btn-disabled" disabled>üìß Email Adh</button>
        <button class="btn btn-disabled" disabled>üìß Email Penjual</button>
        <button class="btn btn-disabled" disabled>üìß Email Pembeli</button>
        <button class="btn btn-disabled" disabled>üì± WhatsApp</button>
      </div>
    `;
  }

  // =====================
  // Jika approval tidak terkunci ‚Üí lanjut logic normal
  // =====================
  const salesSudahTTD = row.status_sales && row.status_sales.includes("‚úÖ");
  const adhSudahTTD = row.status_adh && row.status_adh.includes("‚úÖ");
  const penjualSudahTTD = row.status_penjual && row.status_penjual.includes("‚úÖ");

  function isActive(role) {
    if (role === "sales") return true;
    if (role === "adh") return salesSudahTTD;
    if (role === "penjual") return salesSudahTTD && adhSudahTTD;
    if (role === "pembeli") return salesSudahTTD && adhSudahTTD && penjualSudahTTD;
    return false;
  }

  return `
    <div class="aksi-cell">

      <button class="btn btn-email ${!isActive("sales") ? "btn-disabled" : ""}" 
        ${!isActive("sales") ? "disabled" : ""}
        onclick="handleNotifClick('email','sales','${noperjanjian}','${row.status_sales}')">
        üìß Email Sales
      </button>

      <button class="btn btn-email ${!isActive("adh") ? "btn-disabled" : ""}" 
        ${!isActive("adh") ? "disabled" : ""}
        onclick="handleNotifClick('email','adh','${noperjanjian}','${row.status_adh}')">
        üìß Email Adh
      </button>

      <button class="btn btn-email ${!isActive("penjual") ? "btn-disabled" : ""}" 
        ${!isActive("penjual") ? "disabled" : ""}
        onclick="handleNotifClick('email','penjual','${noperjanjian}','${row.status_penjual}')">
        üìß Email Penjual
      </button>

      <button class="btn btn-email ${!isActive("pembeli") ? "btn-disabled" : ""}" 
        ${!isActive("pembeli") ? "disabled" : ""}
        onclick="handleNotifClick('email','pembeli','${noperjanjian}','${row.status_pembeli}')">
        üìß Email Pembeli
      </button>

      ${nohp ? `
      <button class="btn btn-wa ${!isActive("pembeli") ? "btn-disabled" : ""}" 
        ${!isActive("pembeli") ? "disabled" : ""}
        onclick="handleNotifClick('wa','pembeli','${noperjanjian}','${row.status_pembeli}','${nohp}','${docId}')">
        üì± WhatsApp
      </button>` : ""}
    </div>`;
}


function handleNotifClick(type, role, noperjanjian, status, nohp = null, docId = null) {
  if (status && status.includes("‚úÖ")) {
    alert(`‚úÖ ${role.toUpperCase()} sudah tanda tangan. Pengingat tidak perlu dikirim.`);
    return;
  }
  if (type === "email") {
    kirimEmail(role, noperjanjian);
  } else if (type === "wa" && nohp) {
    kirimWA(nohp, noperjanjian, docId);
  }
}

function kirimEmail(role, noperjanjian) {
  fetch(`${window.notifyUrl}&type=email&role=${role}&noperjanjian=${noperjanjian}`)
    .then(res => res.text())
    .then(() => alert(`üìß Pengingat email untuk ${role.toUpperCase()} dikirim!`))
    .catch(err => alert("Gagal kirim email: " + err.message));
}

function kirimWA(nohp, noperjanjian, docId) {
  const scriptUrl = "https://script.google.com/macros/s/AKfycbwyutAXOuSEfy1yItsWsWNCPBzOqyI-lktXPUdizX3H05Bj-syHkbrUIIbWWPGvXDBI8Q/exec";
  if (nohp && !nohp.startsWith("0") && (nohp.length === 11 || nohp.length === 12)) {
    nohp = "0" + nohp;
  }
  const safeDocId = docId || "DOC_ID_TIDAK_DITEMUKAN";
  const linkTTD = `${scriptUrl}?mode=acc&noperjanjian=${encodeURIComponent(noperjanjian.trim())}&docId=${encodeURIComponent(safeDocId)}`;
  const pesan = encodeURIComponent(`Halo! Silakan tandatangani dokumen perjanjian Anda di link berikut:\n${linkTTD}`);
  window.open(`https://wa.me/${nohp.replace(/^0/, "62")}?text=${pesan}`, "_blank");
}

// =============================
// 6Ô∏è‚É£ Muat Data Tabel + Filter per Cabang
// =============================
let allStatusData = [];

function loadStatusData() {
  fetch(window.apiUrl)
    .then(res => res.json())
    .then(data => {
      // Ambil kode dari global
      const allowedCodes = window.kodeCabang; // array: ["MKS","PRE","MMJ"] atau ["PRE"]

      // Filter hanya jika bukan admin
      if (!allowedCodes.includes("ADMIN")) {
        data = data.filter(row => {
          const npj = (row.noperjanjian || "").toUpperCase();
          return allowedCodes.some(code => npj.includes(code));
        });
      }

      allStatusData = data;
      renderFilteredTable(data);

      document.getElementById("lastUpdate").textContent =
        "Terakhir diperbarui: " + new Date().toLocaleTimeString("id-ID", { hour12: false });
    })
    .catch(err => {
      document.querySelector("#statusTable tbody").innerHTML = `
        <tr><td colspan="15" style="color:red;">Gagal memuat data: ${err.message}</td></tr>`;
    });
}


function renderFilteredTable(data) {
  const tbody = document.querySelector("#statusTable tbody");
  tbody.innerHTML = "";
  if (!data.length) {
    tbody.innerHTML = `<tr><td colspan="14" style="text-align:center;">Tidak ada data ditemukan</td></tr>`;
    return;
  }

  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.noperjanjian || "-"}</td>
      <td>${row.nama_perusahaan || "-"}</td>
      <td>${row.alamat_pembeli || "-"}</td>
      <td>${row.email_pembeli || "-"}</td>
      <td>${row.nohp_pembeli || "-"}</td>
      <td>${row.statusApproval && row.statusApproval.trim() !== "" 
    ? row.statusApproval 
    : "PENDING"}</td>
      <td>${formatWaktu(row.waktu_sales)}</td>
      <td>${makeStatus(row.status_sales)}</td>
      <td>${formatWaktu(row.waktu_adh)}</td>
      <td>${makeStatus(row.status_adh)}</td>
      <td>${formatWaktu(row.waktu_penjual)}</td>
      <td>${makeStatus(row.status_penjual)}</td>
      <td>${formatWaktu(row.waktu_pembeli)}</td>
      <td>${makeStatus(row.status_pembeli)}</td>
      <td>${makeAksiButtons(row)}</td>`;
    tbody.appendChild(tr);
  });
}

function handleSearch(event) {
  event.preventDefault();
  const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
  if (!keyword) {
    renderFilteredTable(allStatusData);
    return;
  }
  const filtered = allStatusData.filter(row =>
    (row.noperjanjian || "").toLowerCase().includes(keyword) ||
    (row.nama_perusahaan || "").toLowerCase().includes(keyword)
  );
  renderFilteredTable(filtered);
}
</script>



        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const themeToggle = document.getElementById("themeToggle");

                // Ambil tema dari localStorage
                const currentTheme = localStorage.getItem("theme") || "light";

                // Set awal tema
                if (currentTheme === "dark") {
                    document.body.classList.add("dark-mode");
                    themeToggle.checked = true;
                } else {
                    document.body.classList.remove("dark-mode");
                    themeToggle.checked = false;
                }

                // Event ketika switch diubah
                themeToggle.addEventListener("change", function () {
                    if (themeToggle.checked) {
                        document.body.classList.add("dark-mode");
                        localStorage.setItem("theme", "dark");
                    } else {
                        document.body.classList.remove("dark-mode");
                        localStorage.setItem("theme", "light");
                    }
                });
            });
        </script>



        <!-- Main JS-->
        <script src="js/bootstrap5-init.js"></script>
        <script src="js/main-vanilla.js"></script>
        <script src="js/swiper-bundle-11.2.10.min.js"></script>
        <script src="js/aos.js"></script>
        <script src="js/modern-plugins.js"></script>


</body>

</html>
<!-- end document-->